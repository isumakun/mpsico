<table class="table table-bordered">
    <tr>
        <td colspan="6"><b><center>RESULTADO DE LAS CONDICIONES INTRALABORALES EVALUADAS</center></b></td>
    </tr>
    <tr>
        <td rowspan="2"><b><center>RESULTADO DE LAS CONDICIONES INTRALABORALES EVALUADAS</center></b></td>
        <td colspan="6"><b><center>PORCENTAJE DE TRABAJADORES</center></b></td>
    </tr>
    <tr>
        <td><b>SIN<br>RIESGO</b></td>
        <td><b>RIESGO<br>BAJO</b></td>
        <td><b>RIESGO<br>MEDIO</b></td>
        <td><b>RIESGO<br>ALTO</b></td>
        <td><b>RIESGO<br>MUY ALTO</b></td>
    </tr>
    <tr><td colspan="6"><b>LIDERAZGO Y RELACIONES SOCIALES EN EL TRABAJO</b></td></tr>
    <tr>
        <td>Características del liderazgo</td>
        <td><?php echo getNumeroA(0, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(0, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(0, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(0, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(0, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Relaciones sociales en el trabajo</td>
        <td><?php echo getNumeroA(1, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(1, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(1, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(1, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(1, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Retroalimentación del desempeño</td>
        <td><?php echo getNumeroA(2, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(2, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(2, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(2, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(2, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Relación con los colaboradores (subordinados)</td>
        <td><?php echo getNumeroA(3, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(3, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(3, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(3, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(3, "Riesgo muy alto"); ?></td>
    </tr>
    <tr><td colspan="6"><b>CONTROL SOBRE EL TRABAJO</b></td></tr>
    <tr>
        <td>Claridad de rol</td>
        <td><?php echo getNumeroA(4, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(4, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(4, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(4, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(4, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Capacitación</td>
        <td><?php echo getNumeroA(5, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(5, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(5, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(5, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(5, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Participación y manejo del cambio</td>
        <td><?php echo getNumeroA(6, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(6, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(6, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(6, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(6, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Oportunidades para el uso y desarrollo de habilidades y conocimientos</td>
        <td><?php echo getNumeroA(7, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(7, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(7, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(7, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(7, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Control y autonomía sobre el trabajo</td>
        <td><?php echo getNumeroA(8, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(8, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(8, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(8, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(8, "Riesgo muy alto"); ?></td>
    </tr>
    <tr><td colspan="6"><b>DEMANDAS DEL TRABAJO</b></td></tr>
    <tr>
        <td>Demandas ambientales y de esfuerzo físico</td>
        <td><?php echo getNumeroA(9, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(9, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(9, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(9, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(9, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Demandas emocionales</td>
        <td><?php echo getNumeroA(10, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(10, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(10, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(10, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(10, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Demandas cuantitativas</td>
        <td><?php echo getNumeroA(11, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(11, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(11, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(11, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(11, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Influencia del trabajo sobre el entorno extralaboral</td>
        <td><?php echo getNumeroA(12, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(12, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(12, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(12, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(12, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Exigencias de responsabilidad del cargo</td>
        <td><?php echo getNumeroA(13, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(13, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(13, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(13, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(13, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Demandas de carga mental</td>
        <td><?php echo getNumeroA(14, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(14, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(14, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(14, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(14, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Consistencia del rol</td>
        <td><?php echo getNumeroA(15, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(15, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(15, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(15, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(15, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Demandas de la jornada de trabajo</td>
        <td><?php echo getNumeroA(16, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(16, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(16, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(16, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(16, "Riesgo muy alto"); ?></td>
    </tr>
    <tr><td colspan="6"><b>RECOMPENSAS</b></td></tr>
    <tr>
        <td>Recompensas derivadas de la pertenencia a la organización y del trabajo que se realiza</td>
        <td><?php echo getNumeroA(17, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(17, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(17, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(17, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(17, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Reconocimiento y compensación</td>
        <td><?php echo getNumeroA(18, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?php echo getNumeroA(18, "Riesgo bajo"); ?></td>
        <td><?php echo getNumeroA(18, "Riesgo medio"); ?></td>
        <td><?php echo getNumeroA(18, "Riesgo alto"); ?></td>
        <td><?php echo getNumeroA(18, "Riesgo muy alto"); ?></td>
    </tr>
</table>

<?php

function getNumeroA($pos, $baremo) {

    $link = conectar();

    $sql = "SELECT *
            FROM
            fichatrabajo AS ft
            INNER JOIN aspirante AS a
            ON (ft.Aspirante_idAspirante = a.idAspirante)
            INNER JOIN cuestionario AS c
            ON (c.Aspirante_idAspirante = a.idAspirante)
            INNER JOIN empresa AS e
            ON (a.Empresa_idEmpresa = e.idEmpresa)
            INNER JOIN area AS ar
            ON (ar.idArea = ft.Area_idArea)
        WHERE c.Numero = 3";

    if ($_POST['empresa'] != 'all') {
        $count = 1;
        foreach ($_POST['empresa'] as $empresa) {
            if ($count==1) {
                $sql .= " AND (e.idEmpresa = $empresa ";
            }else{
                $sql .= " OR e.idEmpresa = $empresa ";
            }
            $count++;
        }
        $sql .= ")";
    }

    if ($_POST['area'] != 'all') {
         $sql .= " AND ar.idArea = '{$_POST['area']}'";
    }

    $sql .= " GROUP BY ft.idFichaTrabajo";

    $aspirantes = mysql_query($sql, $link);

    $cantidad = mysql_num_rows($aspirantes);
    //$cantidad = $cantidad;

    $count = 0;
    while ($line = mysql_fetch_array($aspirantes)) {

        $sql3 = "SELECT d.Valor
                FROM
                dimension AS d
                INNER JOIN cuestionario AS c
                    ON (d.Cuestionario_idCuestionario = c.idCuestionario)
                    WHERE c.Aspirante_idAspirante = " . $line['idAspirante'] . " AND Numero = 3";


        $valDim = mysql_query($sql3, $link);

        $aux = mysql_result($valDim, $pos);

        if ($aux === $baremo) {
            $count++;
        }
    }
    $porcentaje = ($count * 100) / $cantidad;
    $result = round($porcentaje, 0) . "%";
    return $result;
}
