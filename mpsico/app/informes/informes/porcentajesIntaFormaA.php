<table class="table table-bordered">
    <tr>
        <td colspan="6"><b><center>RESULTADO DE LAS CONDICIONES INTRALABORALES EVALUADAS</center></b></td>
    </tr>
    <tr>
        <td rowspan="2"><b><center>RESULTADO DE LAS CONDICIONES INTRALABORALES EVALUADAS</center></b></td>
        <td colspan="6"><b><center>PORCENTAJE DE TRABAJADORES</center></b></td>
    </tr>
    <tr>
        <td><b>SIN<br>RIESGO</b></td>
        <td><b>RIESGO<br>BAJO</b></td>
        <td><b>RIESGO<br>MEDIO</b></td>
        <td><b>RIESGO<br>ALTO</b></td>
        <td><b>RIESGO<br>MUY ALTO</b></td>
    </tr>
    <tr><td colspan="6"><b>LIDERAZGO Y RELACIONES SOCIALES EN EL TRABAJO</b></td></tr>
    <tr>
        <td>Características del liderazgo</td>
        <td><?=getNumeroA(0, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(0, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(0, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(0, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(0, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Relaciones sociales en el trabajo</td>
        <td><?=getNumeroA(1, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(1, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(1, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(1, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(1, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Retroalimentación del desempeño</td>
        <td><?=getNumeroA(2, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(2, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(2, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(2, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(2, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Relación con los colaboradores (subordinados)</td>
        <td><?=getNumeroA(3, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(3, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(3, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(3, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(3, "Riesgo muy alto"); ?></td>
    </tr>
    <tr><td colspan="6"><b>CONTROL SOBRE EL TRABAJO</b></td></tr>
    <tr>
        <td>Claridad de rol</td>
        <td><?=getNumeroA(4, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(4, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(4, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(4, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(4, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Capacitación</td>
        <td><?=getNumeroA(5, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(5, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(5, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(5, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(5, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Participación y manejo del cambio</td>
        <td><?=getNumeroA(6, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(6, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(6, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(6, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(6, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Oportunidades para el uso y desarrollo de habilidades y conocimientos</td>
        <td><?=getNumeroA(7, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(7, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(7, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(7, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(7, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Control y autonomía sobre el trabajo</td>
        <td><?=getNumeroA(8, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(8, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(8, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(8, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(8, "Riesgo muy alto"); ?></td>
    </tr>
    <tr><td colspan="6"><b>DEMANDAS DEL TRABAJO</b></td></tr>
    <tr>
        <td>Demandas ambientales y de esfuerzo físico</td>
        <td><?=getNumeroA(9, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(9, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(9, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(9, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(9, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Demandas emocionales</td>
        <td><?=getNumeroA(10, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(10, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(10, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(10, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(10, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Demandas cuantitativas</td>
        <td><?=getNumeroA(11, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(11, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(11, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(11, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(11, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Influencia del trabajo sobre el entorno extralaboral</td>
        <td><?=getNumeroA(12, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(12, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(12, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(12, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(12, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Exigencias de responsabilidad del cargo</td>
        <td><?=getNumeroA(13, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(13, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(13, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(13, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(13, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Demandas de carga mental</td>
        <td><?=getNumeroA(14, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(14, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(14, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(14, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(14, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Consistencia del rol</td>
        <td><?=getNumeroA(15, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(15, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(15, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(15, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(15, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Demandas de la jornada de trabajo</td>
        <td><?=getNumeroA(16, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(16, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(16, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(16, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(16, "Riesgo muy alto"); ?></td>
    </tr>
    <tr><td colspan="6"><b>RECOMPENSAS</b></td></tr>
    <tr>
        <td>Recompensas derivadas de la pertenencia a la organización y del trabajo que se realiza</td>
        <td><?=getNumeroA(17, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(17, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(17, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(17, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(17, "Riesgo muy alto"); ?></td>
    </tr>
    <tr>
        <td>Reconocimiento y compensación</td>
        <td><?=getNumeroA(18, "Sin riesgo o riesgo despreciable"); ?></td>
        <td><?=getNumeroA(18, "Riesgo bajo"); ?></td>
        <td><?=getNumeroA(18, "Riesgo medio"); ?></td>
        <td><?=getNumeroA(18, "Riesgo alto"); ?></td>
        <td><?=getNumeroA(18, "Riesgo muy alto"); ?></td>
    </tr>
</table>

<?php

function getNumeroA($pos, $baremo) {

    // Connect to the database using PDO
    $pdo = conectar(); // Assumes the 'conectar' function returns a PDO instance

    // Base SQL query
    $sql = "SELECT *
            FROM fichatrabajo
            INNER JOIN aspirante 
                ON fichatrabajo.Aspirante_idAspirante = aspirante.idAspirante
            INNER JOIN cuestionario 
                ON cuestionario.Aspirante_idAspirante = aspirante.idAspirante
            INNER JOIN empresa 
                ON aspirante.Empresa_idEmpresa = empresa.idEmpresa
            WHERE cuestionario.Numero = 3";

    // Adding filters based on query parameters
    $params = [];
    if (isset($_GET['empresa']) && $_GET['empresa'] !== 'all') {
        $sql .= " AND idEmpresa = :empresa";
        $params[':empresa'] = $_GET['empresa'];
    }

    if (isset($_GET['area']) && $_GET['area'] !== 'all') {
        $sql .= " AND Area_idArea = :area";
        $params[':area'] = $_GET['area'];
    }

    $sql .= " GROUP BY idFichaTrabajo";

    // Execute the query
    $stmt = $pdo->prepare($sql);
    $stmt->execute($params);

    $aspirantes = $stmt->fetchAll(PDO::FETCH_ASSOC);
    $cantidad = count($aspirantes);
    $count = 0;

    // Process each aspirant
    foreach ($aspirantes as $line) {
        $sql3 = "SELECT dimension.Valor
                 FROM dimension
                 INNER JOIN cuestionario
                    ON dimension.Cuestionario_idCuestionario = cuestionario.idCuestionario
                 WHERE cuestionario.Aspirante_idAspirante = :idAspirante
                   AND Numero = 3";

        $stmt3 = $pdo->prepare($sql3);
        $stmt3->execute([':idAspirante' => $line['idAspirante']]);
        $val_dim = $stmt3->fetchAll(PDO::FETCH_COLUMN, 0);

        $aux = $val_dim[$pos] ?? null;

        if ($aux === $baremo) {
            $count++;
        }
    }

    // Calculate percentage
    $porcentaje = ($cantidad > 0) ? ($count * 100) / $cantidad : 0;
    $result = round($porcentaje, 0) . "%";
    return $result;
}
